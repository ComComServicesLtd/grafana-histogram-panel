{"version":3,"sources":["../src/histogram.js"],"names":["angular","$","moment","_","kbn","HistogramTooltip","module","directive","$rootScope","timeSrv","restrict","template","link","scope","elem","ctrl","dashboard","panel","data","annotations","sortedSeries","legendSideLastValue","rootScope","$root","self","isPng","bind","event","ranges","$apply","setTime","from","utc","xaxis","to","zoomPlot","zoomOut","onAppEvent","info","sharedCrosshair","plot","setCrosshair","x","pos","y","clearCrosshair","events","on","renderData","refresh","render_panel","getLegendHeight","panelHeight","legend","show","rightSide","alignAsTable","legendSeries","filter","series","hideFromLegend","total","length","Math","min","floor","setElementHeight","height","css","e","console","log","shouldAbortRender","isString","render_png","width","drawHook","yaxis","getYAxes","i","axis","formater","valueFormats","yaxes","format","isNumber","decimals","updateLegendValues","tickDecimals","scaledDecimals","$$phase","$digest","label","yaxisLabel","text","appendTo","rightLabel","processOffsetHook","gridMargin","left","right","options","max","getFFT","stats","Number","MIN_VALUE","MAX_VALUE","avg","current","count","datapoints","stack","hooks","draw","processOffset","stackpercent","percentage","bars","fill","barWidth","zero","lineWidth","align","shadowSize","grid","minBorderMargin","markings","backgroundColor","borderWidth","hoverable","color","margin","selection","mode","crosshair","tooltip","shared","hiddenSeries","alias","addAnnotations","configureAxisOptions","sortBy","zindex","callPlot","incrementRenderCounter","renderingCompleted","start","end","publishAppEvent","shouldDelayDraw","setTimeout","translateFillOption","types","position","markerSize","item","newState","eventType","source","name","iconColor","levels","keys","ticks","isUndefined","range","valueOf","timezone","getTimezone","timeformat","time_format","defaults","index","logBase","push","secondY","clone","configureAxisMode","tickFormatter","val","secPerTick","oneDay","oneYear","url","html"],"mappings":"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","file":"histogram.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport HistogramTooltip from './histogram_tooltip.js';\nimport 'jquery.flot';\nimport 'jquery.flot.selection';\nimport 'jquery.flot.time';\nimport 'jquery.flot.stack';\nimport 'jquery.flot.stackpercent';\nimport 'jquery.flot.fillbelow';\nimport 'jquery.flot.crosshair';\nimport 'app/plugins/panel/graph/jquery.flot.events';\n\nangular.module('grafana.directives').directive('grafanaHistogram', function($rootScope, timeSrv) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var dashboard = ctrl.dashboard;\n      var panel = ctrl.panel;\n      var data, annotations;\n      var sortedSeries;\n      var legendSideLastValue = null;\n      var rootScope = scope.$root;\n      var self = this;\n      var isPng = false;\n      \n      \n        elem.bind(\"plotselected\", function (event, ranges) {\n            \n            \n          \n          if(scope.isPng){\n                      scope.$apply(function() {\n          timeSrv.setTime({\n            from  : moment.utc(ranges.xaxis.from),\n            to    : moment.utc(ranges.xaxis.to),\n          });\n        });\n                      \n          } else {\n              scope.zoomPlot(ranges.xaxis.from,ranges.xaxis.to);\n              \n          }\n      });\n        \n     \n        elem.bind(\"dblclick\", function (event) {\n        \n\n                 scope.zoomOut();\n      });\n        \n        \n\n      rootScope.onAppEvent('setCrosshair', function(event, info) {\n        // do not need to to this if event is from this panel\n        if (info.scope === scope) {\n          return;\n        }\n\n        if(dashboard.sharedCrosshair) {\n          var plot = elem.data().plot;\n          if (plot) {\n            plot.setCrosshair({ x: info.pos.x, y: info.pos.y });\n          }\n        }\n      }, scope);\n\n      rootScope.onAppEvent('clearCrosshair', function() {\n        var plot = elem.data().plot;\n        if (plot) {\n          plot.clearCrosshair();\n        }\n      }, scope);\n\n      // Receive render events\n      ctrl.events.on('render', function(renderData) {\n        data = renderData || data;\n        if (!data) {\n          ctrl.refresh();\n          return;\n        }\n        annotations = data.annotations || annotations;\n        render_panel();\n      });\n\n      function getLegendHeight(panelHeight) {\n        if (!panel.legend.show || panel.legend.rightSide) {\n          return 2;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var legendSeries = _.filter(data, function(series) {\n            return series.hideFromLegend(panel.legend) === false;\n          });\n          var total = 23 + (22 * legendSeries.length);\n          return Math.min(total, Math.floor(panelHeight/2));\n        } else {\n          return 26;\n        }\n      }\n\n      function setElementHeight() {\n        try {\n          var height = ctrl.height - getLegendHeight(ctrl.height);\n          elem.css('height', height + 'px');\n\n          return true;\n        } catch(e) { // IE throws errors sometimes\n          console.log(e);\n          return false;\n        }\n      }\n\n      function shouldAbortRender() {\n        if (!data) {\n          return true;\n        }\n\n        if (!setElementHeight()) { return true; }\n\n        \n        if(_.isString(data)) {\n          render_png(data);\n          data = [];\n        }\n        \n        console.log(\"Should Abort Render();\");\n        console.log(data);\n\n        if (elem.width() === 0) {\n          return true;\n        }\n      }\n\n      function drawHook(plot) {\n        // Update legend values\n        var yaxis = plot.getYAxes();\n        \n        if(!isPng){\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          var axis = yaxis[series.yaxis - 1];\n          var formater = kbn.valueFormats[panel.yaxes[series.yaxis - 1].format];\n\n          // decimal override\n          if (_.isNumber(panel.decimals)) {\n            series.updateLegendValues(formater, panel.decimals, null);\n          } else {\n            // auto decimals\n            // legend and tooltip gets one more decimal precision\n            // than graph legend ticks\n            var tickDecimals = (axis.tickDecimals || -1) + 1;\n            series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n          }\n\n          if(!rootScope.$$phase) { scope.$digest(); }\n        }\n        }\n        \n        // add left axis labels\n        if (panel.yaxes[0].label) {\n          var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n            .text(panel.yaxes[0].label)\n            .appendTo(elem);\n\n          yaxisLabel.css(\"margin-top\", yaxisLabel.width() / 2);\n        }\n\n        // add right axis labels\n        if (panel.yaxes[1].label) {\n          var rightLabel = $(\"<div class='axisLabel right-yaxis-label'></div>\")\n            .text(panel.yaxes[1].label)\n            .appendTo(elem);\n\n          rightLabel.css(\"margin-top\", rightLabel.width() / 2);\n        }\n      }\n\n      function processOffsetHook(plot, gridMargin) {\n        var left = panel.yaxes[0];\n        var right = panel.yaxes[1];\n        if (left.show && left.label) { gridMargin.left = 20; }\n        if (right.show && right.label) { gridMargin.right = 20; }\n        \n   \n   if(this.isPng){\n                // apply y-axis min/max options\n        var yaxis = plot.getYAxes();\n        for (var i = 0; i < yaxis.length; i++) {\n          var axis = yaxis[i];\n          axis.options.max = 0;\n          axis.options.min = 500;\n        }\n      \n      }\n        \n      }\n\n      function getFFT(series) {\n          \n          if(isPng){\n              return ;//[];\n          }\n          \n        //  console.log(series);\n\n       // series.yaxis = 1; // TODO check\n        series.stats.total = 0;\n        series.stats.max = Number.MIN_VALUE;\n        series.stats.min = Number.MAX_VALUE;\n        series.stats.avg = null;\n        series.stats.current = null;\n        series.stats.count = series.datapoints.length;\n        return series.datapoints;\n      }\n\n      // Function for rendering panel\n      function render_panel() {\n        if (shouldAbortRender()) {\n          //return;\n        }\n        \n        \n        // this.seriesList = [];\n         //  this.data = [];\n\n        var stack = panel.stack ? true : null;\n\n        // Populate element\n        var options = {\n          hooks: {\n            draw: [drawHook],\n            processOffset: [processOffsetHook],\n          },\n          legend: { show: false },\n          series: {\n            stackpercent: panel.stack ? panel.percentage : false,\n            stack: panel.percentage ? null : stack,\n            bars:   {\n              show: true,\n              fill: 0.9,\n              barWidth: 1,\n              zero: false,\n              lineWidth: 0,\n              align: 'center'\n            },\n            shadowSize: 0\n          },\n          yaxes: [],\n          xaxis: {},\n          grid: {\n            minBorderMargin: 0,\n            markings: [],\n            backgroundColor: null,\n            borderWidth: 0,\n            hoverable: true,\n            color: '#c8c8c8',\n            margin: { left: 0, right: 0 },\n          },\n          selection: {\n            mode: \"x\",\n            color: '#666'\n          },\n          crosshair: {\n            mode: panel.tooltip.shared || dashboard.sharedCrosshair ? \"x\" : null\n          }\n        };\n\n       // var scopedVars = ctrl.panel.scopedVars;\n    ////    var bucketSize = !panel.bucketSize && panel.bucketSize !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.bucketSize.toString(), scopedVars));\n    //    var minValue = !panel.minValue && panel.minValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.minValue.toString(), scopedVars));\n    //    var maxValue = !panel.maxValue && panel.maxValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.maxValue.toString(), scopedVars));\nif(!isPng){\n\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          series.data = getFFT(series);\n          \n          options.series.bars.barWidth = ((series.data[series.data.length-1][0] + series.data[0][0])/series.data.length);//(elem.width()/series.data.length);\n\n          // if hidden remove points and disable stack\n          if (ctrl.hiddenSeries[series.alias]) {\n            series.data = [];\n            series.stack = false;\n          }\n        }\n\n       // if (data.length && data[0].stats.timeStep) {\n          //data[0].stats.timeStep / 1.5;\n       // }\n} else {\n    \n addAnnotations(options);   \n}\n       \n     //  panel.yaxes[1].show = true;\n        configureAxisOptions(data, options);\n      //  addHistogramAxis(options);\n       // options.selection = {};\n\n        sortedSeries = _.sortBy(data, function(series) { return series.zindex; });\n\n        function callPlot(incrementRenderCounter) {\n          try {\n            $.plot(elem, sortedSeries, options);\n          } catch (e) {\n            console.log('flotcharts error', e);\n          }\n\n          if (incrementRenderCounter) {\n            ctrl.renderingCompleted();\n          }\n        }\n        \n        scope.isPng = isPng;\n        \n        \n         scope.zoomPlot = function(start, end) {\n             \n             options.xaxis.min = start;\n             options.xaxis.max = end;\n\n             callPlot(true);\n        };\n        \n       scope.zoomOut = function() {\n           if(isPng){\n             //  this.ctrl.events.emit('zoom-out');\n               this.ctrl.publishAppEvent('zoom-out',2);\n           } else {\n             options.xaxis.min = null;\n             options.xaxis.max = null;\n             callPlot(true);\n           }\n             \n        };\n        \n\n        if (shouldDelayDraw(panel)) {\n          // temp fix for legends on the side, need to render twice to get dimensions right\n          callPlot(false);\n          setTimeout(function() { callPlot(true); }, 50);\n          legendSideLastValue = panel.legend.rightSide;\n        }\n        else {\n          callPlot(true);\n        }\n      }\n\n      function translateFillOption(fill) {\n        return fill === 0 ? 0.001 : fill/10;\n      }\n\n      function shouldDelayDraw(panel) {\n        if (panel.legend.rightSide) {\n          return true;\n        }\n        if (legendSideLastValue !== null && panel.legend.rightSide !== legendSideLastValue) {\n          return true;\n        }\n      }\n      \n       function addAnnotations(options) {\n           \n           \n        if (!annotations || annotations.length === 0) {\n          return;\n        }\n\n        var types = {};\n        types['$__alerting'] = {\n          color: 'rgba(237, 46, 24, 1)',\n          position: 'BOTTOM',\n          markerSize: 5,\n        };\n\n        types['$__ok'] = {\n          color: 'rgba(11, 237, 50, 1)',\n          position: 'BOTTOM',\n          markerSize: 5,\n        };\n\n        types['$__no_data'] = {\n          color: 'rgba(150, 150, 150, 1)',\n          position: 'BOTTOM',\n          markerSize: 5,\n        };\n\n        types['$__execution_error'] = ['$__no_data'];\n\n        for (var i = 0; i < annotations.length; i++) {\n          var item = annotations[i];\n          if (item.newState) {\n            console.log(item.newState);\n            item.eventType = '$__' + item.newState;\n            continue;\n          }\n\n          if (!types[item.source.name]) {\n            types[item.source.name] = {\n              color: item.source.iconColor,\n              position: 'BOTTOM',\n              markerSize: 5,\n            };\n          }\n        }\n\n        options.events = {\n          levels: _.keys(types).length + 1,\n          data: annotations,\n          types: types,\n        };\n      }\n\n      \n           function configureAxisOptions(data, options) {\n               \n               \n\n        \n        if(isPng){\n        var ticks = elem.width() / 100;\n        var min = _.isUndefined(ctrl.range.from) ? null : ctrl.range.from.valueOf();\n        var max = _.isUndefined(ctrl.range.to) ? null : ctrl.range.to.valueOf();\n\n        options.xaxis = {\n          timezone: dashboard.getTimezone(),\n          show: panel.xaxis.show,\n          mode: \"time\",\n          min: min,\n          max: max,\n          label: \"Datetime\",\n          ticks: ticks,\n          timeformat: time_format(ticks, min, max),\n        };\n        \n                       \n        var defaults = {\n          position: 'left',\n          show: true,\n          index: 1,\n          logBase:1,\n          max: 8000,\n          min: 0\n        };\n\n        options.yaxes.push(defaults);\n\n          var secondY = _.clone(defaults);\n          secondY.index = 2;\n          secondY.show = true;\n          secondY.logBase = 1;\n          secondY.position = 'right';\n          options.yaxes.push(secondY);\n\n          \n          \n            \n        } else {\n            \n          options.xaxis = {\n          show: panel['x-axis'],\n          label: \"Values\",\n        };\n        \n                       \n        var defaults = {\n          position: 'left',\n          show: true,\n          index: 1,\n          logBase:1,\n          max: null,\n          min: null\n        };\n\n        options.yaxes.push(defaults);\n\n          var secondY = _.clone(defaults);\n          secondY.index = 2;\n          secondY.show = true;\n          secondY.logBase = 1;\n          secondY.position = 'right';\n          options.yaxes.push(secondY);\n\n          \n            \n        }\n        \n        \n\n\n      }\n\n\n\n      function configureAxisMode(axis, format) {\n        axis.tickFormatter = function(val, axis) {\n          return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n        };\n      }\n\n      function time_format(ticks, min, max) {\n        if (min && max && ticks) {\n          var range = max - min;\n          var secPerTick = (range/ticks) / 1000;\n          var oneDay = 86400000;\n          var oneYear = 31536000000;\n\n          if (secPerTick <= 45) {\n            return \"%H:%M:%S\";\n          }\n          if (secPerTick <= 7200 || range <= oneDay) {\n            return \"%H:%M\";\n          }\n          if (secPerTick <= 80000) {\n            return \"%m/%d %H:%M\";\n          }\n          if (secPerTick <= 2419200 || range <= oneYear) {\n            return \"%m/%d\";\n          }\n          return \"%Y-%m\";\n        }\n\n        return \"%H:%M\";\n      }\n\n      function render_png(url) {\n        isPng = true; //' + elem.height() + ' ' + elem.width() + '\n        elem.html('<img style=\"padding-top: 9px; padding-left: 34px; padding-bottom: 21px; padding-right: 34px;\" height=\"100%\" width=\"100%\" src=\"' + url + '\"></img>');\n      }\n\n      new HistogramTooltip(elem, dashboard, scope, function() {\n        return sortedSeries;\n      });\n\n    }\n  };\n});\n"]}